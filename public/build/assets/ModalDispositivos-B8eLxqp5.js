import{j as e}from"./ui-CxdvOzk8.js";import{m as ts,t as u,a as $}from"./app-D2djsAIy.js";import{r as o,_ as rs}from"./recharts-B16uQ_Zp.js";import{B as p}from"./button-Bjaxs6gg.js";import{I as Fe}from"./input-Ca_GxhjA.js";import{L as _}from"./label-6BOq3ZzE.js";import{T as ns}from"./textarea-CaaKqtpP.js";import{u as is,S as ls,C as de,c as we}from"./react-select-creatable.esm-C32KgQo_.js";import{C as qe}from"./checkbox-CaE4Puk5.js";import{D as me,a as xe,b as pe,c as he,e as ke}from"./dialog-DoswhpAf.js";import{T as W,a as q,b as K,c as H}from"./tooltip-C675c2So.js";import{S as ze,a as G,L as Ae,D as I,g as Ue,b as Ke}from"./DeviceIcon-CCebdQBE.js";import{P as Re}from"./plus-BdgF4T8b.js";import{M as Se}from"./map-pin-B6MGBFhT.js";import{S as Ce}from"./square-pen-6qCxIJZ2.js";import{S as os,K as cs}from"./share-2-C-Le8CSz.js";import{a as ds}from"./trophy-41xlpHeA.js";import{a as z}from"./circle-alert-BUSeI3Lb.js";import{a as ms}from"./circle-check-big-DKZvEq1H.js";import{T as Ve}from"./trash-2-DghiETJk.js";import"./react-B1hewrmX.js";import"./index--i9LXxpm.js";import"./utils-DvwAYYBZ.js";import"./index-DtwPC3MI.js";import"./memoize-one.esm-C_vqz2--.js";import"./index-BnX2aouM.js";import"./index-BsIecJEN.js";import"./check-C_IBZmq_.js";import"./createLucideIcon-BBA9I-xQ.js";import"./x-C-8u8pOo.js";import"./activity-DiIEwa5r.js";import"./archive-DEiaE80P.js";import"./wifi-off-DUi4CIxr.js";import"./arrow-left-B17tfIkq.js";import"./wrench-Bk2yZqnD.js";import"./building-2-Dm3FgcsS.js";import"./zap-1HMIGlWi.js";import"./chevrons-up-down-DaqTssCh.js";import"./circle-play-Dthy1u5D.js";import"./clock-rsHRdq3d.js";import"./cloud-upload-CUVtKsIr.js";import"./cpu-rfhdE1Ln.js";import"./server-WoqNRRBA.js";import"./download-CRovyn-I.js";import"./ellipsis-DD_sq3ud.js";import"./external-link-D4kgwzSg.js";import"./eye-Bhnt7WyV.js";import"./file-spreadsheet-DP1B9Kxi.js";import"./filter-C7rLzdBM.js";import"./memory-stick--yHBs_zv.js";import"./house-Csy0F4Ln.js";import"./upload-DgRI5uT4.js";import"./info-DjRDCVbv.js";import"./loader-circle-BSxZztzU.js";import"./timer-DmmoSr9O.js";import"./monitor--_KUovl-.js";import"./sun-BDo30IWo.js";import"./play-DlNAJO-n.js";import"./refresh-cw-Ck3NAieY.js";import"./rotate-ccw-Pe8vli6_.js";import"./search-BYwieh_P.js";import"./smartphone-DjIgDxH-.js";import"./star-Bpo0FjGK.js";import"./table-Um-mGLX3.js";import"./ticket-plus-CCZ0Z2of.js";import"./ticket-NZxvcyxK.js";import"./trending-up-iFJZgfSe.js";import"./triangle-alert-Dwpv9XSR.js";import"./user-plus-TUxKnim4.js";import"./user-B9S7Zak9.js";import"./users-DGeSYAzz.js";import"./wifi-Catyo0Iu.js";var xs=o.forwardRef(function(D,B){var j=is(D);return o.createElement(ls,rs({ref:B},j))}),We=xs;const Ta=({visible:D,onClose:B,tenantName:j,devices:A,brands:C,models:w,systems:y,shareDevice:L,name_devices:S,apartmentId:x,tenantId:v,tenants:U})=>{var Le,Pe;const[R,N]=o.useState(!1),[E,He]=o.useState(null),[ue,Q]=o.useState(A),[ge,fe]=o.useState(L);console.log(ge);const[Ge,Y]=o.useState(!1),[O,De]=o.useState(!1),[k,J]=o.useState(C),[X,Z]=o.useState(w),[ee,se]=o.useState(y),[ae,te]=o.useState(S),[b,P]=o.useState({type:"",id:null}),je=async s=>{try{const a=ue.filter(m=>m.is_in_ninjaone===!0);if(a.length===0){u.error("No hay dispositivos en NinjaOne para exportar");return}let r="",n={};switch(s){case"all":r=route("devices.export.ninjaone"),n={devices:a.map(m=>m.id)};break;case"building":r=route("devices.export.ninjaone.building"),n={tenant_id:v,apartment_id:x};break;case"apartment":r=route("devices.export.ninjaone.apartment"),n={tenant_id:v,apartment_id:x};break}const i=await $.post(r,n,{responseType:"blob"}),l=new Blob([i.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),h=window.URL.createObjectURL(l),d=document.createElement("a");d.href=h,d.setAttribute("download",`ninjaone-devices-${s}-${new Date().toISOString().split("T")[0]}.xlsx`),document.body.appendChild(d),d.click(),d.remove(),u.success(`Dispositivos exportados correctamente (${s})`)}catch(a){console.error("Error exporting devices:",a),u.error("Error al exportar dispositivos")}};o.useEffect(()=>{Q(A),fe(L),J(C),Z(w),se(y),te(S)},[A,L,C,w,y,S]);const{data:t,setData:g,reset:Ee}=ts({id:null,name:"",brand_id:"",new_brand:"",model_id:"",new_model:"",system_id:"",new_system:"",name_device_id:"",new_name_device:"",apartment_id:x,tenant_id:v,tenants:[],ubicacion:"",icon_id:"",is_in_ninjaone:!1}),Ie=async(s,a,r=[])=>{var n;try{const i=await $.post(route("devices.share",s),{tenant_id:v,tenant_ids:a,apartment_id:x,unshare_tenant_ids:r});if(i.data.success){const l=i.data.device;console.log(l),Q(d=>d.map(m=>m.id===l.id?l:m));const h=(n=l.shared_with)==null?void 0:n.some(d=>d.id===v);fe(d=>h?d.some(c=>c.id===l.id)?d.map(c=>c.id===l.id?l:c):[...d,l]:d.filter(c=>c.id!==l.id)),u.success(r.length>0?"Device updated":"Device shared"),N(!1)}}catch(i){console.error("Error sharing device:",i),u.error("Error sharing device")}},Qe=()=>{Ee(),Y(!0),De(!1)},Ye=s=>{var a,r,n,i,l;g({id:s.id,name:s.name,brand_id:((a=s.brand_id)==null?void 0:a.toString())||"",model_id:((r=s.model_id)==null?void 0:r.toString())||"",system_id:((n=s.system_id)==null?void 0:n.toString())||"",name_device_id:((i=s.name_device_id)==null?void 0:i.toString())||"",new_brand:"",new_model:"",new_system:"",new_name_device:"",apartment_id:x,tenant_id:v,tenants:((l=s.tenants)==null?void 0:l.map(h=>h.id))||[],ubicacion:s.ubicacion||"",icon_id:s.icon_id||"",is_in_ninjaone:s.is_in_ninjaone||!1}),Y(!0),De(!0)},Je=()=>{const s=[];return!t.name_device_id&&!t.new_name_device&&s.push("Device name required"),!t.brand_id&&!t.new_brand&&s.push("Marca requerida"),s},Xe=async s=>{s.preventDefault();const a=Je();if(a.length>0){a.forEach(n=>u.error(n));return}const r={...t,...t.new_brand&&{brand:t.new_brand},...t.brand_id&&t.model_id&&{model_id:t.model_id},...t.brand_id&&t.new_model&&{model:t.new_model},...t.model_id&&t.system_id&&{system_id:t.system_id},...t.model_id&&t.new_system&&{system:t.new_system},...t.new_name_device&&{name_device:t.new_name_device},tenants:t.tenants||[]};try{const i=(O?await $.put(route("devices.update",t.id),r):await $.post(route("devices.store"),r)).data.device;if(console.log(i),i){if(Q(l=>O?l.map(h=>h.id===i.id?i:h):[...l,i]),t.new_name_device&&i.name_device){const l=[...ae,i.name_device];te(l)}if(t.new_brand&&i.brand){const l=[...k,i.brand];J(l)}if(t.new_model&&i.model){const l=[...X,i.model];Z(l)}if(t.new_system&&i.system){const l=[...ee,i.system];se(l)}u.success(O?"Device updated":"Device created"),Ee(),Y(!1)}}catch(n){u.error(n instanceof Error?n.message:O?"Error al actualizar":"Error al crear")}},Ze=async s=>{try{await $.delete(route("devices.removeFromTenant",s),{data:{tenant_id:v}}),Q(a=>a.filter(r=>r.id!==s)),fe(a=>a.filter(r=>r.id!==s)),u.success("Device removed from tenant successfully")}catch{u.error("Error removing device from tenant")}},es=()=>e.jsx(me,{open:!!b.id,onOpenChange:()=>P({type:"",id:null}),children:e.jsxs(xe,{className:"sm:max-w-[500px]",children:[e.jsx(pe,{children:e.jsx(he,{children:b.canForce?"Force Delete Confirmation":"Delete Confirmation"})}),e.jsx("div",{className:"py-4",children:b.canForce?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"text-yellow-600",children:"⚠️"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-yellow-800",children:"This item is currently in use"}),e.jsxs("p",{className:"text-sm text-yellow-700 mt-1",children:["There are ",b.deviceCount," device(s) using this ",b.type,"."]})]})]})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"What would you like to do?"}),e.jsxs("div",{className:"grid gap-3",children:[e.jsx(p,{variant:"outline",onClick:()=>P({type:"",id:null}),className:"justify-start h-auto p-4",children:e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"font-medium",children:"Cancel"}),e.jsx("div",{className:"text-sm ",children:"Don't delete anything"})]})}),e.jsx(p,{variant:"destructive",onClick:()=>{b.id&&Oe(b.id,b.type,!0)},className:"justify-start h-auto p-4",children:e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"font-medium",children:"Force Delete"}),e.jsxs("div",{className:"text-sm opacity-90",children:["Delete the ",b.type," and remove all associated devices"]})]})})]})]})]}):e.jsx("p",{children:"Are you sure you want to permanently delete this item?"})}),!b.canForce&&e.jsxs(ke,{children:[e.jsx(p,{variant:"outline",onClick:()=>P({type:"",id:null}),children:"Cancel"}),e.jsx(p,{variant:"destructive",onClick:()=>{b.id&&Oe(b.id,b.type)},children:"Delete"})]})]})}),ss=(s,a)=>{P({type:a,id:s})},Oe=async(s,a,r=!1)=>{var n,i,l,h,d;try{const m={brand:"brands.destroy",model:"models.destroy",system:"systems.destroy",name_device:"name_devices.destroy"}[a];console.log(`Eliminando ${a} con ID: ${s}, endpoint: ${m}, force: ${r}`),console.log(`URL generada: ${route(m,s)}`);const c=await $.delete(route(m,s),{data:{force:r}});if(console.log("Respuesta del servidor:",c),c.status===200&&c.data.success){switch(u.success(c.data.message||`${a.charAt(0).toUpperCase()+a.slice(1)} deleted successfully`),a){case"brand":J(M=>M.filter(T=>T.id!==s)),t.brand_id===s.toString()&&g({...t,brand_id:"",new_brand:"",model_id:"",new_model:"",system_id:"",new_system:""});break;case"model":Z(M=>M.filter(T=>T.id!==s)),t.model_id===s.toString()&&g({...t,model_id:"",new_model:"",system_id:"",new_system:""});break;case"system":se(M=>M.filter(T=>T.id!==s)),t.system_id===s.toString()&&g({...t,system_id:"",new_system:""});break;case"name_device":te(M=>M.filter(T=>T.id!==s)),t.name_device_id===s.toString()&&g({...t,name_device_id:"",new_name_device:"",brand_id:"",new_brand:"",model_id:"",new_model:"",system_id:"",new_system:""});break}r&&window.location.reload()}}catch(m){console.error("Error deleting:",m);const c=m;if(console.error("Respuesta del servidor:",c.response),((n=c.response)==null?void 0:n.status)===422&&((l=(i=c.response)==null?void 0:i.data)!=null&&l.can_force)){P({type:a,id:s,deviceCount:c.response.data.devices_count,canForce:!0}),u.error(c.response.data.message);return}else(d=(h=c.response)==null?void 0:h.data)!=null&&d.message?u.error(c.response.data.message):u.error(`Error deleting ${a}: ${c.message}`);P({type:"",id:null})}},[f,re]=o.useState(null),as=()=>{const[s,a]=o.useState(""),r=async()=>{if(f)try{switch(await $.put(route({brand:"brands.update",model:"models.update",system:"systems.update",name_device:"name_devices.update"}[f.type],f.id),{name:s}),f.type){case"brand":J(n=>n.map(i=>i.id===f.id?{...i,name:s}:i));break;case"model":Z(n=>n.map(i=>i.id===f.id?{...i,name:s}:i));break;case"system":se(n=>n.map(i=>i.id===f.id?{...i,name:s}:i));break;case"name_device":te(n=>n.map(i=>i.id===f.id?{...i,name:s}:i));break}u.success("Updated successfully"),re(null)}catch(n){console.error("Error updating:",n),u.error("Error updating")}};return e.jsx(me,{open:!!f,onOpenChange:()=>re(null),children:e.jsxs(xe,{className:"sm:max-w-[425px]",children:["                ",e.jsx(pe,{children:e.jsxs(he,{children:["Edit ",f==null?void 0:f.type]})}),e.jsx("div",{className:"py-4",children:e.jsx(Fe,{value:s||(f==null?void 0:f.name)||"",onChange:n=>a(n.target.value)})}),e.jsxs(ke,{children:[e.jsx(p,{variant:"outline",onClick:()=>re(null),children:"Cancel"}),e.jsx(p,{onClick:r,children:"Save"})]})]})})},ne=({children:s,...a})=>e.jsx(we.Option,{...a,children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsx("div",{children:s}),!a.data.__isNew__&&a.data.value&&e.jsxs("div",{className:"flex gap-1",children:[e.jsx(p,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0 text-blue-500 hover:text-primary",onClick:r=>{r.stopPropagation(),a.data.type&&a.data.value&&a.data.label&&re({type:a.data.type,id:parseInt(a.data.value),name:a.data.label})},children:e.jsx(Ce,{className:"h-3 w-3"})}),e.jsx(p,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0 text-red-500 hover:text-red-700",onClick:r=>{r.stopPropagation(),a.data.value&&a.data.type&&ss(parseInt(a.data.value),a.data.type)},children:e.jsx(Ve,{className:"h-3 w-3"})})]})]})}),[Me,ie]=o.useState(k),[Te,V]=o.useState(X),[$e,F]=o.useState(ee),[Be,be]=o.useState(ae),ye=o.useCallback(s=>{if(!s){ie(k);return}const a=k.filter(r=>{var n;return((n=r.name_device_id)==null?void 0:n.toString())===s});ie(a.length>0?a:k)},[k]),ve=o.useCallback(s=>{if(!s){V(w);return}const a=w.filter(r=>{var n;return((n=r.brand_id)==null?void 0:n.toString())===s});V(a.length>0?a:w)},[w]),Ne=o.useCallback(s=>{if(!s){F(y);return}const a=y.filter(r=>{var n;return((n=r.model_id)==null?void 0:n.toString())===s});F(a.length>0?a:y)},[y]),_e=o.useCallback(s=>{if(!s){be(S);return}const a=S.filter(r=>{var n;return((n=r.system_id)==null?void 0:n.toString())===s});be(a.length>0?a:S)},[S]);o.useEffect(()=>{t.name_device_id&&ye(t.name_device_id),t.new_name_device&&(ie([]),V([]),F([])),t.brand_id&&ve(t.brand_id),t.new_brand&&(V([]),F([])),t.model_id&&Ne(t.model_id),t.new_model&&F([]),t.system_id&&_e(t.system_id)},[t.brand_id,t.name_device_id,t.model_id,t.system_id,t.new_name_device,t.new_brand,t.new_model,t.new_system,ye,ve,_e,Ne]),o.useEffect(()=>{be(ae),ie(k),V(X),F(ee)},[ae,k,X,ee]);const le=(s,a)=>{const r=(s==null?void 0:s.__isNew__)??!1,n=`${a}_id`,i=`new_${a}`;g({...t,[n]:r?"":(s==null?void 0:s.value)||"",[i]:r?s==null?void 0:s.label:""}),a==="name_device"&&!r?(ye(String((s==null?void 0:s.value)||"")),g(l=>({...l,brand_id:"",new_brand:"",model_id:"",new_model:"",system_id:"",new_system:""}))):a==="brand"&&!r?(ve(String((s==null?void 0:s.value)||"")),g(l=>({...l,model_id:"",new_model:"",system_id:"",new_system:""}))):a==="model"&&!r?(Ne(String((s==null?void 0:s.value)||"")),g(l=>({...l,system_id:"",new_system:""}))):a==="system"&&!r&&(_e(String((s==null?void 0:s.value)||"")),g(l=>({...l})))},oe=(s,a,r)=>{if(a)return{label:a,value:""};const n=r==null?void 0:r.find(i=>i.id.toString()===(s==null?void 0:s.toString()));return n?{label:n.name,value:n.id}:null},ce=(s,a)=>s==null?void 0:s.map(r=>({label:r.name,value:r.id.toString(),type:a,__isNew__:!1}));return D?e.jsx(me,{open:D,onOpenChange:B,children:e.jsxs(xe,{className:"min-w-[1200px] max-w-[95vw] max-h-[95vh] overflow-y-auto",children:[e.jsx(pe,{children:e.jsxs(he,{className:"text-2xl flex justify-between items-center relative",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"Device Management"}),e.jsxs("div",{className:"flex items-center gap-3 mt-1",children:[e.jsx("span",{className:"text-lg font-medium text-gray-700",children:j==null?void 0:j.name}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500",children:[e.jsxs("span",{className:"bg-blue-100 text-blue-800 px-2 py-1 rounded-full font-medium",children:[ue.length," owned"]}),e.jsxs("span",{className:"bg-green-100 text-green-800 px-2 py-1 rounded-full font-medium",children:[ge.length," shared"]})]})]})]}),e.jsx("div",{className:"flex items-center gap-4",children:e.jsx("img",{src:`/storage/${j==null?void 0:j.photo}`,alt:j==null?void 0:j.name,className:"w-16 h-16 object-cover rounded-full border-3 border-blue-200 shadow-lg",onError:s=>{s.currentTarget.src="/images/default-user.png"}})})]})}),e.jsx("div",{className:"flex justify-between items-center mb-6 p-4 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg border border-blue-100",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(p,{onClick:Qe,className:"gap-2 bg-primary hover:bg-primary text-white shadow-md",children:[e.jsx(Re,{className:"w-4 h-4"})," New Device"]}),e.jsxs("div",{className:"dropdown relative",children:[e.jsxs(p,{variant:"outline",className:"gap-2 flex items-center border-blue-200 hover:bg-blue-50 hover:text-primary shadow-sm",children:[e.jsx(ze,{className:"w-4 h-4 text-primary"})," Export NinjaOne Devices",e.jsx("div",{className:"ml-1 border-l border-blue-300 h-4"}),e.jsx("span",{className:"text-xs text-primary",children:"▼"})]}),e.jsxs("div",{className:"dropdown-content absolute hidden bg-white shadow-lg rounded-lg mt-2 py-2 w-52 z-10 border border-gray-100",children:[e.jsxs("button",{onClick:()=>je("all"),className:"w-full text-left px-4 py-3 text-sm hover:bg-blue-50 flex items-center gap-3 transition-colors",children:[e.jsx(G,{className:"w-4 h-4 text-primary"})," All Devices"]}),e.jsxs("button",{onClick:()=>je("building"),className:"w-full text-left px-4 py-3 text-sm hover:bg-blue-50 flex items-center gap-3 transition-colors",children:[e.jsx(Se,{className:"w-4 h-4 text-green-600"})," By Building"]}),e.jsxs("button",{onClick:()=>je("apartment"),className:"w-full text-left px-4 py-3 text-sm hover:bg-blue-50 flex items-center gap-3 transition-colors",children:[e.jsx(Se,{className:"w-4 h-4 text-purple-600"})," By Apartment"]})]})]})]})}),e.jsx("style",{children:`
                        .dropdown:hover .dropdown-content {
                            display: block;
                        }
                        
                        .react-select-container .react-select__control {
                            border-radius: 8px;
                            border-color: #e5e7eb;
                            min-height: 40px;
                        }
                        
                        .react-select-container .react-select__control:hover {
                            border-color: #3b82f6;
                        }
                        
                        .react-select-container .react-select__control--is-focused {
                            border-color: #3b82f6;
                            box-shadow: 0 0 0 1px #3b82f6;
                        }
                        
                        .react-select-container .react-select__menu {
                            border-radius: 8px;
                            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1);
                        }
                        
                        .react-select-container .react-select__option:hover {
                            background-color: #f3f4f6;
                        }
                        
                        .react-select-container .react-select__option--is-selected {
                            background-color: #3b82f6;
                        }
                        
                        /* Custom scrollbar for table */
                        .overflow-x-auto::-webkit-scrollbar {
                            height: 8px;
                        }
                        
                        .overflow-x-auto::-webkit-scrollbar-track {
                            background: #f1f5f9;
                            border-radius: 4px;
                        }
                        
                        .overflow-x-auto::-webkit-scrollbar-thumb {
                            background: #cbd5e1;
                            border-radius: 4px;
                        }
                        
                        .overflow-x-auto::-webkit-scrollbar-thumb:hover {
                            background: #94a3b8;
                        }
                        
                        /* Table hover effects */
                        .device-row {
                            transition: all 0.2s ease-in-out;
                        }
                        
                        .device-row:hover {
                            transform: translateY(-1px);
                            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
                        }
                        
                        /* Gradient background for shared devices */
                        .bg-green-25 {
                            background-color: #f0f9ff;
                        }
                    `}),Ge&&e.jsxs("div",{className:"mb-8 p-6 border-2 border-blue-100 rounded-xl bg-gradient-to-br from-blue-50 to-indigo-50 shadow-lg",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2",children:[O?e.jsx(Ce,{className:"w-5 h-5 text-primary"}):e.jsx(Re,{className:"w-5 h-5 text-green-600"}),O?"Edit Device":"Add New Device"]}),e.jsxs("form",{onSubmit:Xe,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(_,{className:"flex gap-2 items-center text-gray-700 font-medium",children:[e.jsx(Ae,{className:"w-4 h-4 text-primary"})," Device"]}),e.jsx(de,{components:{Option:ne},isClearable:!0,placeholder:"Select or create device",onChange:s=>le(s,"name_device"),options:ce(Be,"name_device"),value:oe(t.name_device_id,t.new_name_device,Be),className:"react-select-container",classNamePrefix:"react-select"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(_,{className:"flex gap-2 items-center text-gray-700 font-medium",children:[e.jsx(I,{deviceIconId:t.icon_id,size:16})," Device Icon"]}),e.jsx(We,{isClearable:!0,placeholder:"Select device icon",onChange:s=>g("icon_id",(s==null?void 0:s.value)||""),options:(()=>{const s=Ue();return Object.values(s).flatMap(r=>r.devices).map(r=>({label:r.name,value:r.id,icon:r.icon,color:r.color}))})(),value:(()=>{if(!t.icon_id)return null;const s=Ue(),r=Object.values(s).flatMap(n=>n.devices).find(n=>n.id===t.icon_id);return r?{label:r.name,value:r.id,icon:r.icon,color:r.color}:null})(),components:{Option:({children:s,...a})=>e.jsx(we.Option,{...a,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(I,{deviceIconId:a.data.value,size:20}),e.jsx("span",{children:s})]})}),SingleValue:({children:s,...a})=>e.jsx(we.SingleValue,{...a,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(I,{deviceIconId:a.data.value,size:16}),e.jsx("span",{children:s})]})})},className:"react-select-container",classNamePrefix:"react-select"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(_,{className:"flex gap-2 items-center text-gray-700 font-medium",children:[e.jsx(ze,{className:"w-4 h-4 text-green-600"})," Brand"]}),e.jsx(de,{isDisabled:!t.name_device_id&&!t.new_name_device,components:{Option:ne},isClearable:!0,placeholder:"Select or create brand",onChange:s=>le(s,"brand"),options:ce(Me,"brand"),value:oe(t.brand_id,t.new_brand,Me),className:"react-select-container",classNamePrefix:"react-select"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(_,{className:"flex gap-2 items-center text-gray-700 font-medium",children:[e.jsx(os,{className:"w-4 h-4 text-purple-600"})," Model"]}),e.jsx(de,{isDisabled:!t.brand_id&&!t.new_brand,components:{Option:ne},isClearable:!0,placeholder:"Select or create model",onChange:s=>le(s,"model"),options:ce(Te,"model"),value:oe(t.model_id,t.new_model,Te),className:"react-select-container",classNamePrefix:"react-select"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(_,{className:"flex gap-2 items-center text-gray-700 font-medium",children:[e.jsx(cs,{className:"w-4 h-4 text-orange-600"})," System"]}),e.jsx(de,{isDisabled:!t.model_id&&!t.new_model,components:{Option:ne},isClearable:!0,placeholder:"Select or create system",onChange:s=>le(s,"system"),options:ce($e,"system"),value:oe(t.system_id,t.new_system,$e),className:"react-select-container",classNamePrefix:"react-select"})]}),e.jsxs("div",{className:"space-y-2 lg:col-span-2",children:[e.jsxs(_,{className:"flex gap-2 items-center text-gray-700 font-medium",children:[e.jsx(Se,{className:"w-4 h-4 text-purple-600"})," Location/Description"]}),e.jsx(ns,{placeholder:"Enter device location or description (optional)",value:t.ubicacion,onChange:s=>g("ubicacion",s.target.value),rows:3,className:"resize-none border-gray-200 focus:border-blue-400 focus:ring-blue-400"})]}),e.jsxs("div",{className:"flex items-center space-x-3 lg:col-span-2 p-4 bg-white rounded-lg border border-gray-200",children:[e.jsx(qe,{id:"ninjaone",checked:t.is_in_ninjaone,onCheckedChange:s=>g("is_in_ninjaone",!!s),className:"data-[state=checked]:bg-green-600 data-[state=checked]:border-green-600"}),e.jsxs(_,{htmlFor:"ninjaone",className:"flex gap-2 items-center font-medium text-gray-700",children:[e.jsx(G,{className:"w-4 h-4 text-green-600"})," Device is in NinjaOne"]})]})]}),t.is_in_ninjaone&&e.jsxs("div",{className:"space-y-2 p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:[e.jsxs(_,{className:"flex gap-2 items-center text-gray-700 font-medium",children:[e.jsx(ds,{className:"w-4 h-4 text-yellow-600"})," NinjaOne Device Name"]}),e.jsx(Fe,{placeholder:"Enter device name as it appears in NinjaOne",value:t.name||"",onChange:s=>g("name",s.target.value),className:"border-yellow-200 focus:border-yellow-400 focus:ring-yellow-400"}),e.jsx("p",{className:"text-xs text-yellow-700 bg-yellow-100 p-2 rounded",children:"Enter the System Name as shown in NinjaOne (e.g., DESKTOP-6VEP452, DAMIANPC)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(_,{className:"text-gray-700 font-medium",children:"Sharing with members"}),e.jsx(We,{isMulti:!0,options:U.filter(s=>s.id!==v).map(s=>({label:s.name,value:s.id})),onChange:s=>g("tenants",(s==null?void 0:s.map(a=>a.value))||[]),value:(Le=t.tenants)==null?void 0:Le.map(s=>{var a;return{label:((a=U.find(r=>r.id===s))==null?void 0:a.name)||"",value:s}}),className:"react-select-container",classNamePrefix:"react-select"})]}),e.jsxs("div",{className:"flex gap-3 justify-end pt-6 border-t border-gray-200",children:[e.jsx(p,{variant:"outline",onClick:()=>Y(!1),className:"px-6",children:"Cancel"}),e.jsx(p,{type:"submit",className:"px-6 bg-primary hover:bg-primary",children:O?"Update Device":"Save Device"})]})]})]}),e.jsxs("div",{className:"border-2 border-gray-100 rounded-xl overflow-hidden shadow-lg bg-white",children:[e.jsx("div",{className:"bg-gradient-to-r from-gray-50 to-blue-50 px-6 py-4 border-b border-gray-200",children:e.jsxs("h3",{className:"text-lg font-semibold text-gray-800 flex items-center gap-2",children:[e.jsx(Ae,{className:"w-5 h-5 text-primary"}),"Device Inventory"]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gradient-to-r from-blue-50 to-indigo-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-left font-semibold text-gray-700 text-sm uppercase tracking-wide",children:"Device Name"}),e.jsx("th",{className:"px-6 py-4 text-left font-semibold text-gray-700 text-sm uppercase tracking-wide",children:"Brand"}),e.jsx("th",{className:"px-6 py-4 text-left font-semibold text-gray-700 text-sm uppercase tracking-wide",children:"Model"}),e.jsx("th",{className:"px-6 py-4 text-left font-semibold text-gray-700 text-sm uppercase tracking-wide",children:"System"}),e.jsx("th",{className:"px-6 py-4 text-left font-semibold text-gray-700 text-sm uppercase tracking-wide",children:"Location"}),e.jsx("th",{className:"px-6 py-4 text-left font-semibold text-gray-700 text-sm uppercase tracking-wide",children:"NinjaOne Status"}),e.jsx("th",{className:"px-6 py-4 text-left font-semibold text-gray-700 text-sm uppercase tracking-wide",children:"Shared With"}),e.jsx("th",{className:"px-6 py-4 text-center font-semibold text-gray-700 text-sm uppercase tracking-wide",children:"Actions"})]})}),e.jsxs("tbody",{className:"divide-y divide-gray-100",children:[ue.map((s,a)=>{var r,n,i,l,h,d;return e.jsxs("tr",{className:`transition-colors duration-200 hover:bg-blue-50 ${a%2===0?"bg-white":"bg-gray-50"}`,children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(I,{deviceIconId:s.icon_id,size:20})}),e.jsx("div",{children:e.jsx("span",{className:"font-medium text-gray-900",children:((r=s.name_device)==null?void 0:r.name)||"-"})})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"inline-flex px-3 py-1 text-sm font-medium bg-green-100 text-green-800 rounded-full",children:((n=s.brand)==null?void 0:n.name)||"-"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"text-gray-700 font-medium",children:((i=s.model)==null?void 0:i.name)||"-"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"text-gray-700 font-medium",children:((l=s.system)==null?void 0:l.name)||"-"})}),e.jsx("td",{className:"px-6 py-4 max-w-48",children:e.jsx("div",{className:"text-sm text-gray-600 truncate",title:s.ubicacion,children:s.ubicacion||e.jsx("span",{className:"text-gray-400 italic",children:"No location"})})}),e.jsx("td",{className:"px-6 py-4",children:s.is_in_ninjaone?e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-1 bg-green-100 rounded-full",children:e.jsx(G,{className:"w-4 h-4 text-green-600"})}),e.jsx("span",{className:"text-green-700 font-medium",children:"Connected"})]}),s.name&&e.jsxs("div",{className:"text-xs text-gray-600 bg-gray-100 px-2 py-1 rounded",children:["System: ",s.name]}),!s.name&&e.jsxs("div",{className:"text-xs text-orange-600 bg-orange-50 px-2 py-1 rounded flex items-center gap-1",children:[e.jsx(z,{className:"w-3 h-3"}),"No system name"]}),s.ninjaone_status&&e.jsxs("div",{className:"flex items-center gap-1",children:[s.ninjaone_status==="healthy"&&e.jsxs("span",{className:"text-xs bg-green-100 text-green-800 px-2 py-1 rounded-full flex items-center gap-1",children:[e.jsx(ms,{className:"w-3 h-3"})," Healthy"]}),s.ninjaone_status==="warning"&&e.jsxs("span",{className:"text-xs bg-yellow-100 text-yellow-800 px-2 py-1 rounded-full flex items-center gap-1",children:[e.jsx(z,{className:"w-3 h-3"})," Warning"]}),s.ninjaone_status==="critical"&&e.jsxs("span",{className:"text-xs bg-red-100 text-red-800 px-2 py-1 rounded-full flex items-center gap-1",children:[e.jsx(z,{className:"w-3 h-3"})," Critical"]}),s.ninjaone_status==="offline"&&e.jsxs("span",{className:"text-xs bg-gray-100 text-gray-800 px-2 py-1 rounded-full flex items-center gap-1",children:[e.jsx(z,{className:"w-3 h-3"})," Offline"]}),s.ninjaone_status==="maintenance"&&e.jsxs("span",{className:"text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded-full flex items-center gap-1",children:[e.jsx(z,{className:"w-3 h-3"})," Maintenance"]}),s.ninjaone_status==="unknown"&&e.jsxs("span",{className:"text-xs bg-gray-100 text-gray-600 px-2 py-1 rounded-full flex items-center gap-1",children:[e.jsx(z,{className:"w-3 h-3"})," Unknown"]}),(s.ninjaone_issues_count||0)>0&&e.jsxs("span",{className:"text-xs text-red-600 ml-1",children:["(",s.ninjaone_issues_count," issues)"]})]})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-1 bg-gray-100 rounded-full",children:e.jsx(G,{className:"w-4 h-4 text-gray-400"})}),e.jsx("span",{className:"text-gray-500",children:"Not connected"})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex flex-wrap gap-2",children:[(h=s.shared_with)==null?void 0:h.map(m=>e.jsx(W,{children:e.jsxs(q,{children:[e.jsx(K,{children:e.jsx("img",{src:m.photo?`/storage/${m.photo}?v=${Date.now()}`:"/images/default-avatar.png",alt:m.name,className:"w-8 h-8 object-cover rounded-full border-2 border-blue-300 hover:border-blue-500 transition-colors shadow-sm",onError:c=>{c.currentTarget.src="/images/default-user.png"}})}),e.jsx(H,{children:e.jsx("p",{className:"font-medium",children:m.name})})]})},m.id)),!((d=s.shared_with)!=null&&d.length)&&e.jsx("span",{className:"text-gray-400 text-sm italic",children:"Not shared"})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex gap-2 justify-center",children:[e.jsx(W,{children:e.jsxs(q,{children:[e.jsx(K,{asChild:!0,children:e.jsx(p,{variant:"ghost",size:"sm",onClick:()=>{He(s),N(!0)},className:"text-green-600 hover:text-green-800 hover:bg-green-50 p-2",children:e.jsx(Ke,{className:"w-4 h-4"})})}),e.jsx(H,{children:e.jsx("p",{children:"Share device"})})]})}),e.jsx(W,{children:e.jsxs(q,{children:[e.jsx(K,{asChild:!0,children:e.jsx(p,{variant:"ghost",size:"sm",onClick:()=>Ye(s),className:"text-primary hover:text-blue-800 hover:bg-blue-50 p-2",children:e.jsx(Ce,{className:"w-4 h-4"})})}),e.jsx(H,{children:e.jsx("p",{children:"Edit device"})})]})}),e.jsx(W,{children:e.jsxs(q,{children:[e.jsx(K,{asChild:!0,children:e.jsx(p,{variant:"ghost",size:"sm",onClick:()=>Ze(s.id),className:"text-red-600 hover:text-red-800 hover:bg-red-50 p-2",children:e.jsx(Ve,{className:"w-4 h-4"})})}),e.jsx(H,{children:e.jsx("p",{children:"Remove device from this tenant"})})]})})]})})]},s.id)}),ge.map((s,a)=>{var r,n,i,l;return e.jsxs("tr",{className:`transition-colors duration-200 hover:bg-green-50 ${a%2===0?"bg-green-25":"bg-green-50"} border-l-4 border-green-400`,children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:e.jsx(I,{deviceIconId:s.icon_id,size:20})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-gray-900",children:((r=s.name_device)==null?void 0:r.name)||"-"}),e.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-medium bg-green-100 text-green-800 rounded-full",children:"Shared"})]})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"inline-flex px-3 py-1 text-sm font-medium bg-green-100 text-green-800 rounded-full",children:((n=s.brand)==null?void 0:n.name)||"-"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"text-gray-700 font-medium",children:((i=s.model)==null?void 0:i.name)||"-"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"text-gray-700 font-medium",children:((l=s.system)==null?void 0:l.name)||"-"})}),e.jsx("td",{className:"px-6 py-4 max-w-48",children:e.jsx("div",{className:"text-sm text-gray-600 truncate",title:s.ubicacion,children:s.ubicacion||e.jsx("span",{className:"text-gray-400 italic",children:"No location"})})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-1 bg-gray-100 rounded-full",children:e.jsx(G,{className:"w-4 h-4 text-gray-400"})}),e.jsx("span",{className:"text-gray-500 text-sm",children:"View only"})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"flex flex-wrap gap-2",children:s.owner&&s.owner[0]&&e.jsx(W,{children:e.jsxs(q,{children:[e.jsx(K,{children:e.jsxs("div",{className:"flex items-center gap-2 bg-blue-50 px-3 py-1 rounded-full",children:[e.jsx("img",{src:s.owner[0].photo?`/storage/${s.owner[0].photo}`:"/images/default-avatar.png",alt:s.owner[0].name,className:"w-6 h-6 object-cover rounded-full border border-blue-300",onError:h=>{h.currentTarget.src="/images/default-user.png"}}),e.jsx("span",{className:"text-xs font-medium text-primary",children:"Owner"})]})}),e.jsx(H,{children:e.jsxs("p",{className:"font-medium",children:["Owner: ",s.owner[0].name]})})]})})})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"flex justify-center",children:e.jsx("span",{className:"text-sm text-gray-500 italic bg-gray-100 px-3 py-1 rounded-full",children:"Read-only access"})})})]},`shared-${s.id}`)})]})]})})]}),R&&E&&e.jsx(ps,{tenants:U.filter(s=>s.id!==v),sharedWithIds:((Pe=E.shared_with)==null?void 0:Pe.map(s=>s.id))||[],onClose:()=>N(!1),onShare:(s,a)=>Ie(E.id,s,a)}),e.jsxs("div",{children:[e.jsx(as,{}),e.jsx(es,{})]})]})}):null},ps=({tenants:D,sharedWithIds:B,onClose:j,onShare:A})=>{const[C,w]=o.useState(B||[]),[y,L]=o.useState([]);o.useEffect(()=>{console.log("Selected tenants:",C),console.log("Unshared tenants:",y)},[C,y]);const S=x=>{x.preventDefault(),console.log("Sending unshared:",y),A(C,y)};return e.jsx(me,{open:!0,onOpenChange:j,children:e.jsxs(xe,{className:"max-w-lg",children:[e.jsx(pe,{children:e.jsxs(he,{className:"text-xl font-semibold text-gray-800 flex items-center gap-2",children:[e.jsx(Ke,{className:"w-5 h-5 text-primary"}),"Share Device"]})}),e.jsxs("form",{onSubmit:S,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx(_,{className:"text-gray-700 font-medium",children:"Select tenants to share with"}),D.length===0?e.jsx("div",{className:"text-center py-8",children:e.jsx("div",{className:"text-gray-400 text-sm",children:"No other tenants available to share with"})}):e.jsx("div",{className:"max-h-60 overflow-y-auto space-y-3 border border-gray-200 rounded-lg p-4 bg-gray-50",children:D.map(x=>{const v=B.includes(x.id),U=C.includes(x.id);return e.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-white rounded-lg border border-gray-100 hover:border-blue-200 transition-colors",children:[e.jsx(qe,{id:`tenant-${x.id}`,checked:U,onCheckedChange:R=>{R?(w(N=>[...N,x.id]),L(N=>N.filter(E=>E!==x.id))):(w(N=>N.filter(E=>E!==x.id)),v&&L(N=>[...N,x.id]))},className:"data-[state=checked]:bg-primary data-[state=checked]:border-primary"}),e.jsx("img",{src:`/storage/${x.photo}`,className:"h-10 w-10 rounded-full object-cover border-2 border-gray-200",onError:R=>{R.currentTarget.src="/images/default-user.png"}}),e.jsxs("div",{className:"flex-1",children:[e.jsx(_,{htmlFor:`tenant-${x.id}`,className:"cursor-pointer font-medium text-gray-800",children:x.name}),v&&e.jsx("div",{className:"text-xs text-primary mt-1",children:"Currently shared"})]})]},x.id)})})]}),e.jsxs(ke,{className:"gap-3",children:[e.jsx(p,{type:"button",variant:"outline",onClick:j,className:"px-6",children:"Cancel"}),e.jsx(p,{type:"submit",className:"px-6 bg-primary hover:bg-primary",children:"Save Changes"})]})]})]})})};export{Ta as default};
