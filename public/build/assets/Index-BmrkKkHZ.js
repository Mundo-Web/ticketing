import{j as e}from"./ui-B_LlBPKL.js";import{r as _}from"./recharts-C_88tpBl.js";import{A as P}from"./app-layout-Dl_2JLwh.js";import{L as F,t as l}from"./app-BHqtn3Wb.js";import{C as o,a as m,b as I}from"./card-D2PMvY5E.js";import{B as x}from"./badge-D8qydIEn.js";import{B as u}from"./button-D7WChgOL.js";import{I as B}from"./input-CPYfG3NN.js";import{T as H,a as W,b as f}from"./tabs-BAby--lM.js";import{D as z,f as J,a as X,b as q,c as K}from"./dialog-Cpjj7P1V.js";import{C as U}from"./circle-check-big-kRE2lEsQ.js";import{b as V,a as G}from"./x-DCQyXNSS.js";import{R as v}from"./refresh-cw-DkX1lbet.js";import{D as C}from"./database-GGi-pq_Z.js";import{T as y}from"./triangle-alert-CwQCDSSb.js";import{M as S}from"./monitor-DC-EX0Dh.js";import{W as D}from"./wifi-CRwhCiWI.js";import{W as A,L,S as Q}from"./wifi-off-CrOOkx7R.js";import{S as Y}from"./search-Du8maFVh.js";import{E as Z}from"./eye-C0Ej2ac6.js";import{D as ee}from"./download-L7lCOsHB.js";import{S as se}from"./smartphone--tbFG9UO.js";import"./react-B1hewrmX.js";import"./utils-BJRzUxt3.js";import"./tooltip-CZNM2GAl.js";import"./chevron-up-RfB0QmaY.js";import"./createLucideIcon-BiVfa5Ur.js";import"./dropdown-menu-DMNoBHsR.js";import"./check-ei1vhWUY.js";import"./index-BwDU8Ijz.js";import"./index-D4fRSykC.js";import"./index-Cno2KWhz.js";import"./chevrons-up-down-DyCAeWvF.js";function Me({devices:t,stats:i,connection_status:h,error_message:g}){const[d,b]=_.useState(""),[j,k]=_.useState("all"),w=t.filter(s=>{var n,r,p;const a=((n=s.ninjaone_data.systemName)==null?void 0:n.toLowerCase().includes(d.toLowerCase()))||((r=s.ninjaone_data.hostname)==null?void 0:r.toLowerCase().includes(d.toLowerCase()))||((p=s.ninjaone_data.operatingSystem)==null?void 0:p.toLowerCase().includes(d.toLowerCase())),c=j==="all"||j==="online"&&s.ninjaone_data.online||j==="offline"&&!s.ninjaone_data.online||j==="alerts"&&s.alerts_count>0;return a&&c}),T=(s,a)=>s!=null&&s.toLowerCase().includes("mobile")||a!=null&&a.toLowerCase().includes("android")||a!=null&&a.toLowerCase().includes("ios")?e.jsx(se,{className:"w-5 h-5"}):s!=null&&s.toLowerCase().includes("server")||a!=null&&a.toLowerCase().includes("server")?e.jsx(Q,{className:"w-5 h-5"}):e.jsx(G,{className:"w-5 h-5"}),O=s=>{switch(s==null?void 0:s.toLowerCase()){case"healthy":return"bg-green-100 text-green-800 border-green-200";case"warning":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"critical":return"bg-red-100 text-red-800 border-red-200";case"offline":return"bg-gray-100 text-gray-800 border-gray-200";default:return"bg-blue-100 text-blue-800 border-blue-200"}},$=async()=>{try{const a=await(await fetch("/api/ninjaone/test-connection")).json();a.status==="success"?l.success(`Connection successful! Found ${a.device_count} devices.`):l.error(`Connection failed: ${a.message}`)}catch{l.error("Error testing connection")}},E=async()=>{var s;try{l.loading("Refreshing devices...",{id:"refresh-devices"}),(await fetch("/api/ninjaone/devices/refresh",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((s=document.querySelector('meta[name="csrf-token"]'))==null?void 0:s.getAttribute("content"))||""}})).ok?(l.success("Devices refreshed successfully!",{id:"refresh-devices"}),window.location.reload()):l.error("Error refreshing devices",{id:"refresh-devices"})}catch{l.error("Error refreshing devices",{id:"refresh-devices"})}},R=async()=>{l.loading("Checking API routes...",{id:"check-routes"});const s=["/api/ninjaone/test-connection","/api/ninjaone/devices","/api/ninjaone/devices/refresh","/api/ninjaone/devices/123/sync"];for(const a of s)try{const c=await fetch(a,{method:"HEAD"});console.log(`Route ${a}: ${c.status} ${c.statusText}`)}catch(c){console.log(`Route ${a}: Failed to connect`,c)}l.success("Route check completed. See console for details.",{id:"check-routes"})},M=async s=>{var c;const a=t.find(n=>n.ninjaone_data.id===s);console.log("Attempting to sync device:",{id:s,systemName:a==null?void 0:a.ninjaone_data.systemName,hostname:a==null?void 0:a.ninjaone_data.hostname,manufacturer:a==null?void 0:a.ninjaone_data.manufacturer,model:a==null?void 0:a.ninjaone_data.model,hasLocalMapping:a==null?void 0:a.has_local_mapping});try{l.loading("Syncing device...",{id:`sync-${s}`});const n=await fetch(`/api/ninjaone/devices/${s}/sync`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((c=document.querySelector('meta[name="csrf-token"]'))==null?void 0:c.getAttribute("content"))||"",Accept:"application/json"},body:JSON.stringify({systemName:a==null?void 0:a.ninjaone_data.systemName,hostname:a==null?void 0:a.ninjaone_data.hostname,manufacturer:a==null?void 0:a.ninjaone_data.manufacturer,model:a==null?void 0:a.ninjaone_data.model,operatingSystem:a==null?void 0:a.ninjaone_data.operatingSystem,deviceId:s})});console.log("Response status:",n.status),console.log("Response statusText:",n.statusText),console.log("Response url:",n.url);let r;const p=n.headers.get("content-type");if(p&&p.includes("application/json"))r=await n.json();else{const N=await n.text();if(console.log("Non-JSON response:",N),n.status===404){l.error("Sync endpoint not found. Please check if the API route exists.",{id:`sync-${s}`});return}throw new Error(`Server returned non-JSON response (${n.status}): ${N.substring(0,200)}`)}if(console.log("Sync response:",r),n.ok&&r.success)l.success(r.message||"Device synced successfully!",{id:`sync-${s}`}),setTimeout(()=>window.location.reload(),1e3);else{const N=r.message||r.error||`HTTP ${n.status}: ${n.statusText}`;l.error(N,{id:`sync-${s}`}),console.error("Sync error details:",{status:n.status,statusText:n.statusText,data:r}),r.details&&console.error("Detailed error:",r.details)}}catch(n){console.error("Sync error details:",{error:n,deviceId:s,device:a});let r="Network error while syncing device";n instanceof Error&&(console.error("Error message:",n.message),console.error("Error stack:",n.stack),n.message.includes("404")?r="Sync endpoint not found. Please verify the API route exists.":n.message.includes("403")?r="Permission denied. Please check authentication.":n.message.includes("500")?r="Server error. Please check server logs.":n.message.includes("Failed to fetch")?r="Network connection failed. Check your internet connection and CORS settings.":n.message.includes("NetworkError")?r="Network error. The API endpoint might not exist or be accessible.":r=`Error: ${n.message}`),l.error(r,{id:`sync-${s}`})}};return e.jsxs(P,{children:[e.jsx(F,{title:"NinjaOne Devices Dashboard"}),e.jsxs("div",{className:"space-y-6 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"NinjaOne Integration Dashboard"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Real-time device monitoring and management"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(x,{variant:h==="connected"?"default":"destructive",className:h==="connected"?"bg-green-100 text-green-800":"",children:h==="connected"?e.jsxs(e.Fragment,{children:[e.jsx(U,{className:"w-3 h-3 mr-1"}),"Connected"]}):e.jsxs(e.Fragment,{children:[e.jsx(V,{className:"w-3 h-3 mr-1"}),"Connection Error"]})}),e.jsxs(u,{onClick:$,variant:"outline",size:"sm",children:[e.jsx(v,{className:"w-4 h-4 mr-2"}),"Test Connection"]}),e.jsxs(u,{onClick:E,variant:"outline",size:"sm",children:[e.jsx(v,{className:"w-4 h-4 mr-2"}),"Refresh Devices"]}),e.jsxs(u,{onClick:R,variant:"outline",size:"sm",children:[e.jsx(C,{className:"w-4 h-4 mr-2"}),"Check API Routes"]})]})]}),h==="error"&&e.jsx(o,{className:"border-red-200 bg-red-50",children:e.jsx(m,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2 text-red-800",children:[e.jsx(y,{className:"w-5 h-5"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:"Connection Error"}),e.jsx("p",{className:"text-sm mt-1",children:g})]})]})})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-6 gap-4",children:[e.jsx(o,{children:e.jsx(m,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(S,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Devices"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:i.total_devices})]})]})})}),e.jsx(o,{children:e.jsx(m,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:e.jsx(D,{className:"w-5 h-5 text-green-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Online"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:i.online_devices})]})]})})}),e.jsx(o,{children:e.jsx(m,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-red-100 rounded-lg",children:e.jsx(A,{className:"w-5 h-5 text-red-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Offline"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:i.offline_devices})]})]})})}),e.jsx(o,{children:e.jsx(m,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-yellow-100 rounded-lg",children:e.jsx(y,{className:"w-5 h-5 text-yellow-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"With Alerts"}),e.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:i.devices_with_alerts})]})]})})}),e.jsx(o,{children:e.jsx(m,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-purple-100 rounded-lg",children:e.jsx(L,{className:"w-5 h-5 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Mapped"}),e.jsx("p",{className:"text-2xl font-bold text-purple-600",children:i.mapped_devices})]})]})})}),e.jsx(o,{children:e.jsx(m,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-gray-100 rounded-lg",children:e.jsx(C,{className:"w-5 h-5 text-gray-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Unmapped"}),e.jsx("p",{className:"text-2xl font-bold text-gray-600",children:i.unmapped_devices})]})]})})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-center",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(Y,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx(B,{placeholder:"Search devices...",value:d,onChange:s=>b(s.target.value),className:"pl-10"})]}),e.jsx(H,{value:j,onValueChange:s=>k(s),children:e.jsxs(W,{children:[e.jsx(f,{value:"all",children:"All"}),e.jsx(f,{value:"online",children:"Online"}),e.jsx(f,{value:"offline",children:"Offline"}),e.jsx(f,{value:"alerts",children:"With Alerts"})]})})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:w.map(s=>e.jsxs(o,{className:"hover:shadow-lg transition-shadow",children:[e.jsx(I,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`p-2 rounded-lg ${s.ninjaone_data.online?"bg-green-100":"bg-gray-100"}`,children:T(s.ninjaone_data.deviceType,s.ninjaone_data.operatingSystem)}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg",children:s.ninjaone_data.systemName||s.ninjaone_data.hostname}),e.jsx("p",{className:"text-sm text-gray-600",children:s.ninjaone_data.operatingSystem})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:s.ninjaone_data.online?e.jsxs(x,{className:"bg-green-100 text-green-800",children:[e.jsx(D,{className:"w-3 h-3 mr-1"}),"Online"]}):e.jsxs(x,{variant:"secondary",children:[e.jsx(A,{className:"w-3 h-3 mr-1"}),"Offline"]})})]})}),e.jsxs(m,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Health Status:"}),e.jsx(x,{className:O(s.health_status.status),children:s.health_status.status})]}),s.health_status.issuesCount>0&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Issues:"}),e.jsxs(x,{variant:"destructive",children:[e.jsx(y,{className:"w-3 h-3 mr-1"}),s.health_status.issuesCount]})]}),s.alerts_count>0&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Active Alerts:"}),e.jsx(x,{variant:"destructive",children:s.alerts_count})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Local Mapping:"}),s.has_local_mapping?e.jsxs(x,{className:"bg-purple-100 text-purple-800",children:[e.jsx(L,{className:"w-3 h-3 mr-1"}),"Mapped"]}):e.jsx(x,{variant:"outline",children:"Not Mapped"})]}),e.jsxs("div",{className:"pt-3 border-t space-y-2",children:[s.ninjaone_data.serialNumber&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Serial:"}),e.jsx("span",{className:"font-mono",children:s.ninjaone_data.serialNumber})]}),s.ninjaone_data.manufacturer&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Manufacturer:"}),e.jsx("span",{children:s.ninjaone_data.manufacturer})]}),s.ninjaone_data.model&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Model:"}),e.jsx("span",{children:s.ninjaone_data.model})]}),s.ninjaone_data.ipAddress&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"IP:"}),e.jsx("span",{className:"font-mono",children:s.ninjaone_data.ipAddress})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"NinjaOne ID:"}),e.jsx("span",{className:"font-mono",children:s.ninjaone_data.id})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Last Seen:"}),e.jsx("span",{children:new Date(s.ninjaone_data.lastSeenUtc).toLocaleString()})]})]}),e.jsxs("div",{className:"flex gap-2 pt-3 border-t",children:[e.jsxs(z,{children:[e.jsx(J,{asChild:!0,children:e.jsxs(u,{variant:"outline",size:"sm",className:"flex-1",children:[e.jsx(Z,{className:"w-4 h-4 mr-2"}),"Details"]})}),e.jsxs(X,{className:"max-w-2xl",children:[e.jsx(q,{children:e.jsxs(K,{children:["Device Details: ",s.ninjaone_data.systemName]})}),e.jsx(ae,{device:s})]})]}),!s.has_local_mapping&&e.jsxs(u,{variant:"outline",size:"sm",onClick:()=>M(s.ninjaone_data.id),className:"flex-1",title:`Sync device: ${s.ninjaone_data.systemName||s.ninjaone_data.hostname}`,children:[e.jsx(ee,{className:"w-4 h-4 mr-2"}),"Sync to Local"]})]})]})]},s.ninjaone_data.id))}),w.length===0&&e.jsxs(o,{className:"p-12 text-center",children:[e.jsx(S,{className:"w-12 h-12 mx-auto text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No devices found"}),e.jsx("p",{className:"text-gray-600",children:t.length===0?"No devices are available in NinjaOne or there was a connection error.":"No devices match your current filters."})]})]})]})}function ae({device:t}){var i,h,g;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-3",children:"Basic Information"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"System Name:"}),e.jsx("p",{className:"font-medium",children:t.ninjaone_data.systemName})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Hostname:"}),e.jsx("p",{className:"font-medium",children:t.ninjaone_data.hostname})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Operating System:"}),e.jsx("p",{className:"font-medium",children:t.ninjaone_data.operatingSystem})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Serial Number:"}),e.jsx("p",{className:"font-medium",children:t.ninjaone_data.serialNumber||"N/A"})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-3",children:"Health Status"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Status:"}),e.jsx("p",{className:"font-medium",children:t.health_status.status})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Total Issues:"}),e.jsx("p",{className:"font-medium",children:t.health_status.issuesCount})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Critical Issues:"}),e.jsx("p",{className:"font-medium text-red-600",children:t.health_status.criticalCount})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Warning Issues:"}),e.jsx("p",{className:"font-medium text-yellow-600",children:t.health_status.warningCount})]})]})]}),t.alerts.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"font-semibold mb-3",children:["Active Alerts (",t.alerts.length,")"]}),e.jsx("div",{className:"space-y-2 max-h-40 overflow-y-auto",children:t.alerts.map((d,b)=>e.jsxs("div",{className:"p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(y,{className:"w-4 h-4 text-red-500"}),e.jsx("span",{className:"font-medium",children:d.message||"Alert"})]}),d.createdAt&&e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Created: ",new Date(d.createdAt).toLocaleString()]})]},b))})]}),t.local_device&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-3",children:"Local Device Mapping"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Local Name:"}),e.jsx("p",{className:"font-medium",children:t.local_device.name})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Brand:"}),e.jsx("p",{className:"font-medium",children:((i=t.local_device.brand)==null?void 0:i.name)||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Model:"}),e.jsx("p",{className:"font-medium",children:((h=t.local_device.model)==null?void 0:h.name)||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"System:"}),e.jsx("p",{className:"font-medium",children:((g=t.local_device.system)==null?void 0:g.name)||"N/A"})]})]})]})]})}export{Me as default};
