import{j as e}from"./ui-B_LlBPKL.js";import{m as es,t as u,a as M}from"./app-BHqtn3Wb.js";import{r as d,_ as ss}from"./recharts-C_88tpBl.js";import{B as p}from"./button-D7WChgOL.js";import{I as Fe}from"./input-CPYfG3NN.js";import{L as w}from"./label-BFkwPYrm.js";import{T as as}from"./textarea-Cf0M5nmX.js";import{u as ts,S as ns,C as ie,c as je}from"./react-select-creatable.esm-Cl-wr1ni.js";import{C as Ie}from"./checkbox-CkiCC9jw.js";import{D as re,a as le,b as oe,c as ce,e as Ne}from"./dialog-Cpjj7P1V.js";import{T as fe,a as _e,b as ge,c as ve}from"./tooltip-CZNM2GAl.js";import{S as ze,a as ye,L as is,D as q,g as Ae,b as rs}from"./DeviceIcon-D3yqz6Mb.js";import{P as ls}from"./plus-CzQ2zNVS.js";import{M as we}from"./map-pin-DU2QgsnQ.js";import{S as os,K as cs}from"./share-2-BX2Tzb9c.js";import{a as ds}from"./trophy-BpbwooG3.js";import{C as ms}from"./circle-check-big-kRE2lEsQ.js";import{a as I}from"./circle-alert-CQiE_YKh.js";import{S as Ue}from"./square-pen-CZ4LUS4h.js";import{T as Re}from"./trash-2-Cs4R96q7.js";import"./react-B1hewrmX.js";import"./utils-BJRzUxt3.js";import"./index-Cno2KWhz.js";import"./index-BwDU8Ijz.js";import"./index-D4fRSykC.js";import"./check-ei1vhWUY.js";import"./createLucideIcon-BiVfa5Ur.js";import"./x-DCQyXNSS.js";import"./activity-DYMUuslV.js";import"./archive-DNMMvwJ5.js";import"./arrow-left-CPDhjXak.js";import"./zap-Cj_qJnwG.js";import"./building-2-BYrPcrqm.js";import"./calendar-B5ENoLvU.js";import"./chevron-up-RfB0QmaY.js";import"./chevrons-up-down-DyCAeWvF.js";import"./clock-C9AFtO6q.js";import"./cloud-upload-CBWDzHdi.js";import"./database-GGi-pq_Z.js";import"./download-L7lCOsHB.js";import"./ellipsis-Bcr1duWK.js";import"./trending-up-DPs1t5N1.js";import"./eye-C0Ej2ac6.js";import"./file-spreadsheet-Bu5TR--g.js";import"./house-DLs_ngv-.js";import"./upload-DVGHmo7h.js";import"./wifi-off-CrOOkx7R.js";import"./loader-circle-DxDPAbpk.js";import"./monitor-DC-EX0Dh.js";import"./sun-DePERuGU.js";import"./play-B6f8xoDn.js";import"./refresh-cw-DkX1lbet.js";import"./search-Du8maFVh.js";import"./smartphone--tbFG9UO.js";import"./star-C9wwVdhM.js";import"./table-BB7lDMma.js";import"./ticket-plus-DMc59eOu.js";import"./ticket-CqAL-sEh.js";import"./triangle-alert-CwQCDSSb.js";import"./user-plus-BTZB6avM.js";import"./user-CpLSdjZ6.js";import"./users-BUOHIUcQ.js";import"./wifi-CRwhCiWI.js";var xs=d.forwardRef(function(P,T){var _=ts(P);return d.createElement(ns,ss({ref:T},_))}),qe=xs;const Na=({visible:P,onClose:T,tenantName:_,devices:$,brands:F,models:y,systems:N,shareDevice:S,name_devices:b,apartmentId:C,tenantId:m,tenants:z})=>{var Le,Pe;const[de,D]=d.useState(!1),[v,A]=d.useState(null),[me,K]=d.useState($),[xe,he]=d.useState(S);console.log(xe);const[Ke,V]=d.useState(!1),[U,be]=d.useState(!1),[k,W]=d.useState(F),[H,Q]=d.useState(y),[Y,G]=d.useState(N),[J,X]=d.useState(b),[g,B]=d.useState({type:"",id:null}),pe=async s=>{try{const a=me.filter(h=>h.is_in_ninjaone===!0);if(a.length===0){u.error("No hay dispositivos en NinjaOne para exportar");return}let n="",i={};switch(s){case"all":n=route("devices.export.ninjaone"),i={devices:a.map(h=>h.id)};break;case"building":n=route("devices.export.ninjaone.building"),i={tenant_id:m,apartment_id:C};break;case"apartment":n=route("devices.export.ninjaone.apartment"),i={tenant_id:m,apartment_id:C};break}const r=await M.post(n,i,{responseType:"blob"}),l=new Blob([r.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),o=window.URL.createObjectURL(l),c=document.createElement("a");c.href=o,c.setAttribute("download",`ninjaone-devices-${s}-${new Date().toISOString().split("T")[0]}.xlsx`),document.body.appendChild(c),c.click(),c.remove(),u.success(`Dispositivos exportados correctamente (${s})`)}catch(a){console.error("Error exporting devices:",a),u.error("Error al exportar dispositivos")}};d.useEffect(()=>{K($),he(S),W(F),Q(y),G(N),X(b)},[$,S,F,y,N,b]);const{data:t,setData:j,reset:Se}=es({id:null,name:"",brand_id:"",new_brand:"",model_id:"",new_model:"",system_id:"",new_system:"",name_device_id:"",new_name_device:"",apartment_id:C,tenant_id:m,tenants:[],ubicacion:"",icon_id:"",is_in_ninjaone:!1}),Ve=async(s,a,n=[])=>{var i;try{const r=await M.post(route("devices.share",s),{tenant_id:m,tenant_ids:a,apartment_id:C,unshare_tenant_ids:n});if(r.data.success){const l=r.data.device;console.log(l),K(c=>c.map(h=>h.id===l.id?l:h));const o=(i=l.shared_with)==null?void 0:i.some(c=>c.id===m);he(c=>o?c.some(x=>x.id===l.id)?c.map(x=>x.id===l.id?l:x):[...c,l]:c.filter(x=>x.id!==l.id)),u.success(n.length>0?"Device updated":"Device shared"),D(!1)}}catch(r){console.error("Error sharing device:",r),u.error("Error sharing device")}},We=()=>{Se(),V(!0),be(!1)},He=s=>{var a,n,i,r,l;j({id:s.id,name:s.name,brand_id:((a=s.brand_id)==null?void 0:a.toString())||"",model_id:((n=s.model_id)==null?void 0:n.toString())||"",system_id:((i=s.system_id)==null?void 0:i.toString())||"",name_device_id:((r=s.name_device_id)==null?void 0:r.toString())||"",new_brand:"",new_model:"",new_system:"",new_name_device:"",apartment_id:C,tenant_id:m,tenants:((l=s.tenants)==null?void 0:l.map(o=>o.id))||[],ubicacion:s.ubicacion||"",icon_id:s.icon_id||"",is_in_ninjaone:s.is_in_ninjaone||!1}),V(!0),be(!0)},Qe=()=>{const s=[];return!t.name_device_id&&!t.new_name_device&&s.push("Device name required"),!t.brand_id&&!t.new_brand&&s.push("Marca requerida"),s},Ye=async s=>{var i,r;s.preventDefault();const a=Qe();if(a.length>0){a.forEach(l=>u.error(l));return}const n={...t,...t.new_brand&&{brand:t.new_brand},...t.brand_id&&t.model_id&&{model_id:t.model_id},...t.brand_id&&t.new_model&&{model:t.new_model},...t.model_id&&t.system_id&&{system_id:t.system_id},...t.model_id&&t.new_system&&{system:t.new_system},...t.new_name_device&&{name_device:t.new_name_device},tenants:t.tenants||[]};try{const o=(U?await M.put(route("devices.update",t.id),n):await M.post(route("devices.store"),n)).data.device;if(console.log(o),o){if(K(c=>U?c.map(h=>h.id===o.id?o:h):[...c,o]),t.new_name_device&&o.name_device){const c=[...J,o.name_device];X(c)}if(t.new_brand&&o.brand){const c=[...k,o.brand];W(c)}if(t.new_model&&o.model){const c=[...H,o.model];Q(c)}if(t.new_system&&o.system){const c=[...Y,o.system];G(c)}u.success(U?"Device updated":"Device created"),Se(),V(!1)}}catch(l){u.error(((r=(i=l.response)==null?void 0:i.data)==null?void 0:r.message)||(U?"Error al actualizar":"Error al crear"))}},Ge=async s=>{try{await M.delete(route("devices.removeFromTenant",s),{data:{tenant_id:m}}),K(a=>a.filter(n=>n.id!==s)),he(a=>a.filter(n=>n.id!==s)),u.success("Device removed from tenant successfully")}catch{u.error("Error removing device from tenant")}},Je=()=>e.jsx(re,{open:!!g.id,onOpenChange:()=>B({type:"",id:null}),children:e.jsxs(le,{className:"sm:max-w-[500px]",children:[e.jsx(oe,{children:e.jsx(ce,{children:g.canForce?"Force Delete Confirmation":"Delete Confirmation"})}),e.jsx("div",{className:"py-4",children:g.canForce?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"text-yellow-600",children:"⚠️"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-yellow-800",children:"This item is currently in use"}),e.jsxs("p",{className:"text-sm text-yellow-700 mt-1",children:["There are ",g.deviceCount," device(s) using this ",g.type,"."]})]})]})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"What would you like to do?"}),e.jsxs("div",{className:"grid gap-3",children:[e.jsx(p,{variant:"outline",onClick:()=>B({type:"",id:null}),className:"justify-start h-auto p-4",children:e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"font-medium",children:"Cancel"}),e.jsx("div",{className:"text-sm ",children:"Don't delete anything"})]})}),e.jsx(p,{variant:"destructive",onClick:()=>{g.id&&Ce(g.id,g.type,!0)},className:"justify-start h-auto p-4",children:e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"font-medium",children:"Force Delete"}),e.jsxs("div",{className:"text-sm opacity-90",children:["Delete the ",g.type," and remove all associated devices"]})]})})]})]})]}):e.jsx("p",{children:"Are you sure you want to permanently delete this item?"})}),!g.canForce&&e.jsxs(Ne,{children:[e.jsx(p,{variant:"outline",onClick:()=>B({type:"",id:null}),children:"Cancel"}),e.jsx(p,{variant:"destructive",onClick:()=>{g.id&&Ce(g.id,g.type)},children:"Delete"})]})]})}),Xe=(s,a)=>{B({type:a,id:s})},Ce=async(s,a,n=!1)=>{var i,r,l,o,c;try{const h={brand:"brands.destroy",model:"models.destroy",system:"systems.destroy",name_device:"name_devices.destroy"}[a];console.log(`Eliminando ${a} con ID: ${s}, endpoint: ${h}, force: ${n}`),console.log(`URL generada: ${route(h,s)}`);const x=await M.delete(route(h,s),{data:{force:n}});if(console.log("Respuesta del servidor:",x),x.status===200&&x.data.success){switch(u.success(x.data.message||`${a.charAt(0).toUpperCase()+a.slice(1)} deleted successfully`),a){case"brand":W(E=>E.filter(O=>O.id!==s)),t.brand_id===s.toString()&&j({...t,brand_id:"",new_brand:"",model_id:"",new_model:"",system_id:"",new_system:""});break;case"model":Q(E=>E.filter(O=>O.id!==s)),t.model_id===s.toString()&&j({...t,model_id:"",new_model:"",system_id:"",new_system:""});break;case"system":G(E=>E.filter(O=>O.id!==s)),t.system_id===s.toString()&&j({...t,system_id:"",new_system:""});break;case"name_device":X(E=>E.filter(O=>O.id!==s)),t.name_device_id===s.toString()&&j({...t,name_device_id:"",new_name_device:"",brand_id:"",new_brand:"",model_id:"",new_model:"",system_id:"",new_system:""});break}n&&window.location.reload()}}catch(h){console.error("Error deleting:",h);const x=h;if(console.error("Respuesta del servidor:",x.response),((i=x.response)==null?void 0:i.status)===422&&((l=(r=x.response)==null?void 0:r.data)!=null&&l.can_force)){B({type:a,id:s,deviceCount:x.response.data.devices_count,canForce:!0}),u.error(x.response.data.message);return}else(c=(o=x.response)==null?void 0:o.data)!=null&&c.message?u.error(x.response.data.message):u.error(`Error deleting ${a}: ${x.message}`);B({type:"",id:null})}},[f,Z]=d.useState(null),Ze=()=>{const[s,a]=d.useState(""),n=async()=>{if(f)try{switch(await M.put(route({brand:"brands.update",model:"models.update",system:"systems.update",name_device:"name_devices.update"}[f.type],f.id),{name:s}),f.type){case"brand":W(i=>i.map(r=>r.id===f.id?{...r,name:s}:r));break;case"model":Q(i=>i.map(r=>r.id===f.id?{...r,name:s}:r));break;case"system":G(i=>i.map(r=>r.id===f.id?{...r,name:s}:r));break;case"name_device":X(i=>i.map(r=>r.id===f.id?{...r,name:s}:r));break}u.success("Updated successfully"),Z(null)}catch(i){console.error("Error updating:",i),u.error("Error updating")}};return e.jsx(re,{open:!!f,onOpenChange:()=>Z(null),children:e.jsxs(le,{className:"sm:max-w-[425px]",children:["                ",e.jsx(oe,{children:e.jsxs(ce,{children:["Edit ",f==null?void 0:f.type]})}),e.jsx("div",{className:"py-4",children:e.jsx(Fe,{value:s||(f==null?void 0:f.name)||"",onChange:i=>a(i.target.value)})}),e.jsxs(Ne,{children:[e.jsx(p,{variant:"outline",onClick:()=>Z(null),children:"Cancel"}),e.jsx(p,{onClick:n,children:"Save"})]})]})})},ee=({children:s,...a})=>e.jsx(je.Option,{...a,children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsx("div",{children:s}),!a.data.__isNew__&&a.data.value&&e.jsxs("div",{className:"flex gap-1",children:[e.jsx(p,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0 text-blue-500 hover:text-blue-700",onClick:n=>{n.stopPropagation(),Z({type:a.data.type,id:parseInt(a.data.value),name:a.data.label})},children:e.jsx(Ue,{className:"h-3 w-3"})}),e.jsx(p,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0 text-red-500 hover:text-red-700",onClick:n=>{n.stopPropagation(),Xe(parseInt(a.data.value),a.data.type)},children:e.jsx(Re,{className:"h-3 w-3"})})]})]})}),[De,se]=d.useState(k),[ke,R]=d.useState(H),[Ee,L]=d.useState(Y),[Oe,ue]=d.useState(J),Me=s=>{if(!s){se(k);return}const a=k.filter(n=>{var i;return((i=n.name_device_id)==null?void 0:i.toString())===s});se(a.length>0?a:k)},Te=s=>{if(!s){R(y);return}const a=y.filter(n=>{var i;return((i=n.brand_id)==null?void 0:i.toString())===s});R(a.length>0?a:y)},$e=s=>{if(!s){L(N);return}const a=N.filter(n=>{var i;return((i=n.model_id)==null?void 0:i.toString())===s});L(a.length>0?a:N)},Be=s=>{if(!s){ue(b);return}const a=b.filter(n=>{var i;return((i=n.system_id)==null?void 0:i.toString())===s});ue(a.length>0?a:b)};d.useEffect(()=>{t.name_device_id&&Me(t.name_device_id),t.new_name_device&&(se([]),R([]),L([])),t.brand_id&&Te(t.brand_id),t.new_brand&&(R([]),L([])),t.model_id&&$e(t.model_id),t.new_model&&L([]),t.system_id&&Be(t.system_id)},[t.brand_id,t.name_device_id,t.model_id,t.system_id,t.new_name_device,t.new_brand,t.new_model,t.new_system]),d.useEffect(()=>{ue(J),se(k),R(H),L(Y)},[J,k,H,Y]);const ae=(s,a)=>{const n=(s==null?void 0:s.__isNew__)??!1,i=`${a}_id`,r=`new_${a}`;j({...t,[i]:n?"":(s==null?void 0:s.value)||"",[r]:n?s==null?void 0:s.label:""}),a==="name_device"&&!n?(Me((s==null?void 0:s.value)||""),j(l=>({...l,brand_id:"",new_brand:"",model_id:"",new_model:"",system_id:"",new_system:""}))):a==="brand"&&!n?(Te((s==null?void 0:s.value)||""),j(l=>({...l,model_id:"",new_model:"",system_id:"",new_system:""}))):a==="model"&&!n?($e((s==null?void 0:s.value)||""),j(l=>({...l,system_id:"",new_system:""}))):a==="system"&&!n&&(Be((s==null?void 0:s.value)||""),j(l=>({...l})))},te=(s,a,n)=>{if(a)return{label:a,value:""};const i=n==null?void 0:n.find(r=>r.id.toString()===(s==null?void 0:s.toString()));return i?{label:i.name,value:i.id}:null},ne=(s,a)=>s==null?void 0:s.map(n=>({label:n.name,value:n.id.toString(),type:a,__isNew__:!1}));return P?e.jsx(re,{open:P,onOpenChange:T,children:e.jsxs(le,{className:"min-w-[800px] max-h-[90vh] overflow-y-auto",children:[e.jsx(oe,{children:e.jsxs(ce,{className:"text-2xl flex justify-between relative",children:[e.jsxs("div",{children:["Devices of ",_==null?void 0:_.name,e.jsxs("span",{className:"text-sm font-normal ml-2",children:["(",me.length," owned, ",xe.length," shared with me)"]})]}),e.jsx("div",{className:"relative mx-4",children:e.jsx("img",{src:`/storage/${_==null?void 0:_.photo}`,alt:_==null?void 0:_.name,className:"w-20 h-20 object-cover rounded-full border-4 border-secondary fixed right-16",onError:s=>{s.currentTarget.src="/images/default-user.png"}})})]})}),e.jsx("div",{className:"flex justify-between items-center mb-4",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(p,{onClick:We,className:"gap-2",children:[e.jsx(ls,{className:"w-4 h-4"})," New Device"]}),e.jsxs("div",{className:"dropdown relative",children:[e.jsxs(p,{variant:"outline",className:"gap-2 flex items-center",children:[e.jsx(ze,{className:"w-4 h-4"})," Export NinjaOne Devices",e.jsx("div",{className:"ml-1 border-l border-gray-300 h-4"}),e.jsx("span",{className:"text-xs",children:"▼"})]}),e.jsxs("div",{className:"dropdown-content absolute hidden bg-white shadow-md rounded-md mt-1 py-1 w-48 z-10",children:[e.jsxs("button",{onClick:()=>pe("all"),className:"w-full text-left px-4 py-2 text-sm hover:bg-gray-100 flex items-center gap-2",children:[e.jsx(ye,{className:"w-4 h-4"})," All Devices"]}),e.jsxs("button",{onClick:()=>pe("building"),className:"w-full text-left px-4 py-2 text-sm hover:bg-gray-100 flex items-center gap-2",children:[e.jsx(we,{className:"w-4 h-4"})," By Building"]}),e.jsxs("button",{onClick:()=>pe("apartment"),className:"w-full text-left px-4 py-2 text-sm hover:bg-gray-100 flex items-center gap-2",children:[e.jsx(we,{className:"w-4 h-4"})," By Apartment"]})]})]})]})}),e.jsx("style",{children:`.dropdown:hover .dropdown-content {
                        display: block;
                    }`}),Ke&&e.jsxs("form",{onSubmit:Ye,className:"mb-6 space-y-4 p-4 border rounded-lg",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(w,{className:"flex gap-2 items-center",children:[e.jsx(is,{className:"w-4 h-4"})," Device"]}),e.jsx(ie,{components:{Option:ee},isClearable:!0,placeholder:"Select or create",onChange:s=>ae(s,"name_device"),options:ne(Oe,"name_device"),value:te(t.name_device_id,t.new_name_device,Oe),className:"react-select-container",classNamePrefix:"react-select"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(w,{className:"flex gap-2 items-center",children:[e.jsx(q,{deviceIconId:t.icon_id,size:16})," Device Icon"]}),e.jsx(qe,{isClearable:!0,placeholder:"Select device icon",onChange:s=>j("icon_id",(s==null?void 0:s.value)||""),options:(()=>{const s=Ae();return Object.values(s).flatMap(n=>n.devices).map(n=>({label:n.name,value:n.id,icon:n.icon,color:n.color}))})(),value:(()=>{if(!t.icon_id)return null;const s=Ae(),n=Object.values(s).flatMap(i=>i.devices).find(i=>i.id===t.icon_id);return n?{label:n.name,value:n.id,icon:n.icon,color:n.color}:null})(),components:{Option:({children:s,...a})=>e.jsx(je.Option,{...a,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(q,{deviceIconId:a.data.value,size:20}),e.jsx("span",{children:s})]})}),SingleValue:({children:s,...a})=>e.jsx(je.SingleValue,{...a,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(q,{deviceIconId:a.data.value,size:16}),e.jsx("span",{children:s})]})})},className:"react-select-container",classNamePrefix:"react-select"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(w,{className:"flex gap-2 items-center",children:[e.jsx(ze,{className:"w-4 h-4"})," Brand"]}),e.jsx(ie,{isDisabled:!t.name_device_id&&!t.new_name_device,components:{Option:ee},isClearable:!0,placeholder:"Select or create",onChange:s=>ae(s,"brand"),options:ne(De,"brand"),value:te(t.brand_id,t.new_brand,De),className:"react-select-container",classNamePrefix:"react-select"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(w,{className:"flex gap-2 items-center",children:[e.jsx(os,{className:"w-4 h-4"})," Model"]}),e.jsx(ie,{isDisabled:!t.brand_id&&!t.new_brand,components:{Option:ee},isClearable:!0,placeholder:"Select or create",onChange:s=>ae(s,"model"),options:ne(ke,"model"),value:te(t.model_id,t.new_model,ke),className:"react-select-container",classNamePrefix:"react-select"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(w,{className:"flex gap-2 items-center",children:[e.jsx(cs,{className:"w-4 h-4"})," System"]}),e.jsx(ie,{isDisabled:!t.model_id&&!t.new_model,components:{Option:ee},isClearable:!0,placeholder:"Select or create",onChange:s=>ae(s,"system"),options:ne(Ee,"system"),value:te(t.system_id,t.new_system,Ee),className:"react-select-container",classNamePrefix:"react-select"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(w,{className:"flex gap-2 items-center",children:[e.jsx(we,{className:"w-4 h-4"})," Location/Description"]}),e.jsx(as,{placeholder:"Enter device location or description (optional)",value:t.ubicacion,onChange:s=>j("ubicacion",s.target.value),rows:3,className:"resize-none"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ie,{id:"ninjaone",checked:t.is_in_ninjaone,onCheckedChange:s=>j("is_in_ninjaone",!!s)}),e.jsxs(w,{htmlFor:"ninjaone",className:"flex gap-2 items-center",children:[e.jsx(ye,{className:"w-4 h-4"})," Device is in NinjaOne"]})]}),t.is_in_ninjaone&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs(w,{className:"flex gap-2 items-center",children:[e.jsx(ds,{className:"w-4 h-4"})," NinjaOne Device Name"]}),e.jsx(Fe,{placeholder:"Enter device name as it appears in NinjaOne",value:t.name||"",onChange:s=>j("name",s.target.value)}),e.jsx("p",{className:"text-xs text-gray-500",children:"Enter the System Name as shown in NinjaOne (e.g., DESKTOP-6VEP452, DAMIANPC)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{children:"Sharing with members"}),e.jsx(qe,{isMulti:!0,options:z.filter(s=>s.id!==m).map(s=>({label:s.name,value:s.id})),onChange:s=>j("tenants",(s==null?void 0:s.map(a=>a.value))||[]),value:(Le=t.tenants)==null?void 0:Le.map(s=>{var a;return{label:((a=z.find(n=>n.id===s))==null?void 0:a.name)||"",value:s}}),className:"react-select-container",classNamePrefix:"react-select"})]}),e.jsxs("div",{className:"flex gap-2 justify-end pt-4",children:[e.jsx(p,{variant:"outline",onClick:()=>V(!1),children:"Cancel"}),e.jsx(p,{type:"submit",children:U?"Update":"Save"})]})]}),e.jsx("div",{className:"border rounded-lg overflow-visible",children:e.jsx("table",{className:"w-full",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left font-medium",children:"Name"}),e.jsx("th",{className:"px-4 py-3 text-left font-medium",children:"Brand"}),e.jsx("th",{className:"px-4 py-3 text-left font-medium",children:"Model"}),e.jsx("th",{className:"px-4 py-3 text-left font-medium",children:"System"}),e.jsx("th",{className:"px-4 py-3 text-left font-medium",children:"Location"}),e.jsx("th",{className:"px-4 py-3 text-left font-medium",children:"NinjaOne"}),e.jsx("th",{className:"px-4 py-3 text-left font-medium",children:"Shared with"}),e.jsx("th",{className:"px-4 py-3 text-left font-medium",children:"Actions"})]})}),e.jsxs("tbody",{children:[me.map(s=>{var a,n,i,r,l;return e.jsxs("tr",{className:"hover:bg-gray-50 border-b",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(q,{deviceIconId:s.icon_id,size:20}),e.jsx("span",{children:((a=s.name_device)==null?void 0:a.name)||"-"})]})}),e.jsx("td",{className:"px-4 py-3",children:((n=s.brand)==null?void 0:n.name)||"-"}),e.jsx("td",{className:"px-4 py-3",children:((i=s.model)==null?void 0:i.name)||"-"}),e.jsx("td",{className:"px-4 py-3",children:((r=s.system)==null?void 0:r.name)||"-"}),e.jsx("td",{className:"px-4 py-3 max-w-32",children:e.jsx("div",{className:"text-sm text-gray-600 truncate",title:s.ubicacion,children:s.ubicacion||"-"})}),e.jsx("td",{className:"px-4 py-3",children:s.is_in_ninjaone?e.jsxs("div",{className:"flex items-center",children:[e.jsx(ye,{className:"w-4 h-4 text-green-500 mr-1"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-green-600",children:"Yes"}),s.name&&e.jsxs("span",{className:"text-xs text-gray-500",children:["System: ",s.name]}),!s.name&&e.jsx("span",{className:"text-xs text-orange-500",children:"⚠️ No system name"}),s.ninjaone_status&&e.jsxs("div",{className:"mt-1 flex items-center gap-1",children:[s.ninjaone_status==="healthy"&&e.jsxs("span",{className:"text-xs bg-green-100 text-green-800 px-2 py-0.5 rounded-full flex items-center gap-1",children:[e.jsx(ms,{className:"w-3 h-3"})," Healthy"]}),s.ninjaone_status==="warning"&&e.jsxs("span",{className:"text-xs bg-yellow-100 text-yellow-800 px-2 py-0.5 rounded-full flex items-center gap-1",children:[e.jsx(I,{className:"w-3 h-3"})," Warning"]}),s.ninjaone_status==="critical"&&e.jsxs("span",{className:"text-xs bg-red-100 text-red-800 px-2 py-0.5 rounded-full flex items-center gap-1",children:[e.jsx(I,{className:"w-3 h-3"})," Critical"]}),s.ninjaone_status==="offline"&&e.jsxs("span",{className:"text-xs bg-gray-100 text-gray-800 px-2 py-0.5 rounded-full flex items-center gap-1",children:[e.jsx(I,{className:"w-3 h-3"})," Offline"]}),s.ninjaone_status==="maintenance"&&e.jsxs("span",{className:"text-xs bg-blue-100 text-blue-800 px-2 py-0.5 rounded-full flex items-center gap-1",children:[e.jsx(I,{className:"w-3 h-3"})," Maintenance"]}),s.ninjaone_status==="unknown"&&e.jsxs("span",{className:"text-xs bg-gray-100 text-gray-600 px-2 py-0.5 rounded-full flex items-center gap-1",children:[e.jsx(I,{className:"w-3 h-3"})," Unknown"]}),(s.ninjaone_issues_count||0)>0&&e.jsxs("span",{className:"text-xs text-red-600 ml-1",children:["(",s.ninjaone_issues_count," issues)"]})]})]})]}):e.jsx("span",{className:"text-gray-400",children:"No"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("div",{className:"flex flex-wrap gap-1",children:(l=s.shared_with)==null?void 0:l.map(o=>(console.log(o),e.jsx(fe,{children:e.jsxs(_e,{children:[e.jsx(ge,{children:e.jsx("img",{src:o.photo?`/storage/${o.photo}?v=${Date.now()}`:"/images/default-avatar.png",alt:o.name,className:"w-8 h-8 object-cover rounded-full border-2 border-blue-400",onError:c=>{c.currentTarget.src="/images/default-user.png"}},o.photo)}),e.jsx(ve,{children:e.jsx("p",{children:o.name})})]})})))})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(p,{variant:"ghost",size:"sm",onClick:()=>{A(s),D(!0)},className:"text-green-600 hover:text-green-800",children:e.jsx(rs,{className:"w-4 h-4"})}),e.jsx(p,{variant:"ghost",size:"sm",onClick:()=>He(s),className:"text-blue-600 hover:text-blue-800",children:e.jsx(Ue,{className:"w-4 h-4"})}),e.jsx(fe,{children:e.jsxs(_e,{children:[e.jsx(ge,{asChild:!0,children:e.jsx(p,{variant:"ghost",size:"sm",onClick:()=>Ge(s.id),className:"text-red-600 hover:text-red-800",children:e.jsx(Re,{className:"w-4 h-4"})})}),e.jsx(ve,{children:e.jsx("p",{children:"Remove device from this tenant"})})]})})]})})]},s.id)}),xe.map(s=>{var a,n,i,r,l;return e.jsxs("tr",{className:"hover:bg-gray-50 border-b bg-blue-50",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(q,{deviceIconId:s.icon_id,size:20}),e.jsx("span",{children:((a=s.name_device)==null?void 0:a.name)||"-"})]})}),e.jsx("td",{className:"px-4 py-3",children:((n=s.brand)==null?void 0:n.name)||"-"}),e.jsx("td",{className:"px-4 py-3",children:((i=s.model)==null?void 0:i.name)||"-"}),e.jsx("td",{className:"px-4 py-3",children:((r=s.system)==null?void 0:r.name)||"-"}),e.jsx("td",{className:"px-4 py-3 max-w-32",children:e.jsx("div",{className:"text-sm text-gray-600 truncate",title:s.ubicacion,children:s.ubicacion||"-"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("div",{className:"flex flex-wrap gap-1",children:s.owner&&e.jsx(fe,{children:e.jsxs(_e,{children:[e.jsx(ge,{children:e.jsx("img",{src:s.owner?`/storage/${s==null?void 0:s.owner[0].photo}`:"/images/default-avatar.png",alt:s.owner[0].name,className:"w-8 h-8 object-cover rounded-full border-2 border-green-500",onError:o=>{o.currentTarget.src="/images/default-user.png"}})}),e.jsx(ve,{children:e.jsxs("p",{children:["  Own: ",s.owner[0].name||Array.isArray(s.owner)&&((l=s.owner[0])==null?void 0:l.name)||"Unknown"]})})]})},`owner-${s.id}`)})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-500",children:"Shared"})]},`shared-${s.id}`)})]})]})})}),de&&v&&e.jsx(hs,{device:v,tenants:z.filter(s=>s.id!==m),sharedWithIds:((Pe=v.shared_with)==null?void 0:Pe.map(s=>s.id))||[],onClose:()=>D(!1),onShare:(s,a)=>Ve(v.id,s,a)}),e.jsx(Ze,{}),e.jsx(Je,{})]})}):null},hs=({device:P,tenants:T,sharedWithIds:_,onClose:$,onShare:F})=>{const[y,N]=d.useState(_||[]),[S,b]=d.useState([]);d.useEffect(()=>{console.log("Inquilinos seleccionados:",y),console.log("Inquilinos descompartidos:",S)},[y,S]);const C=m=>{m.preventDefault(),console.log("Enviando descompartidos:",S),F(y,S)};return e.jsx(re,{open:!0,onOpenChange:$,children:e.jsxs(le,{className:"max-w-md",children:[e.jsx(oe,{children:e.jsx(ce,{children:"Share device"})}),e.jsxs("form",{onSubmit:C,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx(w,{children:"Select tenants to share with"}),T.length===0?e.jsx("p",{className:"text-sm text-gray-500",children:"No tenants available to share with"}):e.jsx("div",{className:"max-h-60 overflow-y-auto space-y-2 border rounded-md p-3",children:T.map(m=>{const z=_.includes(m.id),de=y.includes(m.id);return e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ie,{id:`tenant-${m.id}`,checked:de,onCheckedChange:D=>{D?(N(v=>[...v,m.id]),b(v=>v.filter(A=>A!==m.id))):(N(v=>v.filter(A=>A!==m.id)),z&&b(v=>[...v,m.id]))}}),e.jsx("img",{src:`/storage/${m.photo}`,className:"h-8 w-8 rounded-full object-cover",onError:D=>{D.currentTarget.src="/images/default-user.png"}}),e.jsx(w,{htmlFor:`tenant-${m.id}`,className:"cursor-pointer",children:m.name})]},m.id)})})]}),e.jsxs(Ne,{children:[e.jsx(p,{type:"button",variant:"outline",onClick:$,children:"Cancel                        "}),e.jsx(p,{type:"submit",children:"Save"})]})]})]})})};export{Na as default};
