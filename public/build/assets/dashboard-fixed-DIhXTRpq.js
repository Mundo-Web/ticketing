import{j as e}from"./ui-D1w9Iw8H.js";import{L as j}from"./app-Czwrd2Mi.js";import{C as a,a as i,b as l,c as o,d as _}from"./card-ujb193xZ.js";import{c as L,B as P}from"./button-BntSAybs.js";import{c as D}from"./utils-B66yfQja.js";import{f as R,B as N}from"./format-B6Rb66cG.js";import{A as p}from"./app-layout-CQEzWHdt.js";import{r as c}from"./recharts-Dld1lWsf.js";import{T as g}from"./tooltip-CQHbb0yU.js";import{T as U}from"./triangle-alert-DrKF4AKN.js";import{T as B}from"./ticket-ChPWs-X9.js";import{C as H}from"./clock-BxVJL7PR.js";import{a as I}from"./circle-check-big-DZU7S_eA.js";import{M as z}from"./monitor-BMYn5xBp.js";import{U as V}from"./user-CtzshXh0.js";import{e as $}from"./es-BahIIYDD.js";import"./react-B1hewrmX.js";import"./x-CNM1Dv5p.js";import"./createLucideIcon-CR-66RMC.js";import"./check-CkciTNW-.js";import"./index-CWijjM2R.js";import"./index-cS_AKGRi.js";import"./index-DrdTBqzy.js";import"./chevrons-up-down-BF_I81uV.js";const F=L("relative w-full rounded-lg border px-4 py-3 text-sm grid has-[>svg]:grid-cols-[calc(var(--spacing)*4)_1fr] grid-cols-[0_1fr] has-[>svg]:gap-x-3 gap-y-0.5 items-start [&>svg]:size-4 [&>svg]:translate-y-0.5 [&>svg]:text-current",{variants:{variant:{default:"bg-background text-foreground",destructive:"text-destructive-foreground [&>svg]:text-current *:data-[slot=alert-description]:text-destructive-foreground/80"}},defaultVariants:{variant:"default"}});function q({className:t,variant:n,...d}){return e.jsx("div",{"data-slot":"alert",role:"alert",className:D(F({variant:n}),t),...d})}function G({className:t,...n}){return e.jsx("div",{"data-slot":"alert-description",className:D("text-muted-foreground col-start-2 grid justify-items-start gap-1 text-sm [&_p]:leading-relaxed",t),...n})}function v({isOpen:t,onClose:n,tickets:d,title:x}){return t?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-4xl max-h-[80vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-xl font-bold",children:x}),e.jsx(P,{variant:"outline",onClick:n,children:"Cerrar"})]}),e.jsx("div",{className:"space-y-2",children:d.map(r=>e.jsx("div",{className:"border p-3 rounded",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:r.title}),e.jsxs("p",{className:"text-sm text-gray-600",children:["#",r.ticket_code]}),e.jsx("p",{className:"text-sm",children:r.description})]}),e.jsx(N,{variant:r.priority==="high"?"destructive":r.priority==="medium"?"default":"secondary",children:r.priority})]})},r.id))})]})}):null}function pe(){const[t,n]=c.useState({activeTickets:0,pendingTickets:0,resolvedTickets:0,totalDevices:0,onlineDevices:0,offlineDevices:0,totalUsers:0,recentTickets:[],deviceStatuses:[],alertCounts:[]}),[d,x]=c.useState(!0),[r,b]=c.useState(null),[S,y]=c.useState(!1),[M,w]=c.useState(!1),[E,T]=c.useState(!1),[h,A]=c.useState([]),f=[{title:"Dashboard",href:"/dashboard"}],k=async()=>{try{x(!0);const s=await fetch("/api/dashboard-data");if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);const C=await s.json();n(C),b(null)}catch(s){console.error("Error fetching dashboard data:",s),b("Error al cargar los datos del dashboard")}finally{x(!1)}};c.useEffect(()=>{k();const s=setInterval(k,3e4);return()=>clearInterval(s)},[]);const u=async(s,C)=>{try{const m=await fetch(`/api/tickets?status=${s}`);if(!m.ok)throw new Error("Error fetching tickets");const O=await m.json();A(O),s==="open"?y(!0):s==="pending"?w(!0):s==="resolved"&&T(!0)}catch(m){console.error("Error fetching tickets:",m)}};return d?e.jsx(g,{children:e.jsxs(p,{breadcrumbs:f,children:[e.jsx(j,{title:"Dashboard"}),e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900 mx-auto"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"Cargando dashboard..."})]})})]})}):r?e.jsx(g,{children:e.jsxs(p,{breadcrumbs:f,children:[e.jsx(j,{title:"Dashboard"}),e.jsxs(q,{variant:"destructive",children:[e.jsx(U,{className:"h-4 w-4"}),e.jsx(G,{children:r})]})]})}):e.jsx(g,{children:e.jsxs(p,{breadcrumbs:f,children:[e.jsx(j,{title:"Dashboard"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs(a,{className:"cursor-pointer hover:shadow-lg transition-shadow",onClick:()=>u("open"),children:[e.jsxs(i,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(l,{className:"text-sm font-medium",children:"Tickets Activos"}),e.jsx(B,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(o,{children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:t.activeTickets}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Tickets en progreso"})]})]}),e.jsxs(a,{className:"cursor-pointer hover:shadow-lg transition-shadow",onClick:()=>u("pending"),children:[e.jsxs(i,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(l,{className:"text-sm font-medium",children:"Tickets Pendientes"}),e.jsx(H,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(o,{children:[e.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:t.pendingTickets}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"En espera de atención"})]})]}),e.jsxs(a,{className:"cursor-pointer hover:shadow-lg transition-shadow",onClick:()=>u("resolved"),children:[e.jsxs(i,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(l,{className:"text-sm font-medium",children:"Tickets Resueltos"}),e.jsx(I,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(o,{children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:t.resolvedTickets}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Completados este mes"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs(a,{children:[e.jsxs(i,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(l,{className:"text-sm font-medium",children:"Total Dispositivos"}),e.jsx(z,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(o,{children:[e.jsx("div",{className:"text-2xl font-bold",children:t.totalDevices}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Dispositivos registrados"})]})]}),e.jsxs(a,{children:[e.jsxs(i,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(l,{className:"text-sm font-medium",children:"Dispositivos Online"}),e.jsx("div",{className:"h-2 w-2 bg-green-500 rounded-full"})]}),e.jsxs(o,{children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:t.onlineDevices}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Conectados actualmente"})]})]}),e.jsxs(a,{children:[e.jsxs(i,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(l,{className:"text-sm font-medium",children:"Dispositivos Offline"}),e.jsx("div",{className:"h-2 w-2 bg-red-500 rounded-full"})]}),e.jsxs(o,{children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:t.offlineDevices}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Sin conexión"})]})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-1 gap-6",children:e.jsxs(a,{children:[e.jsxs(i,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(l,{className:"text-sm font-medium",children:"Total Usuarios"}),e.jsx(V,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(o,{children:[e.jsx("div",{className:"text-2xl font-bold",children:t.totalUsers}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Usuarios registrados en el sistema"})]})]})}),e.jsxs(a,{children:[e.jsxs(i,{children:[e.jsx(l,{children:"Tickets Recientes"}),e.jsx(_,{children:"Los últimos tickets creados en el sistema"})]}),e.jsx(o,{children:t.recentTickets.length>0?e.jsx("div",{className:"space-y-3",children:t.recentTickets.slice(0,5).map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium",children:s.title}),e.jsxs("p",{className:"text-sm text-gray-600",children:["#",s.ticket_code]}),e.jsx("p",{className:"text-xs text-gray-500",children:s.created_at?R(new Date(s.created_at),"dd/MM/yyyy HH:mm",{locale:$}):"Fecha no disponible"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(N,{variant:s.priority==="high"?"destructive":s.priority==="medium"?"default":"secondary",children:s.priority}),e.jsx(N,{variant:"outline",children:s.status})]})]},s.id))}):e.jsx("p",{className:"text-gray-500 text-center py-4",children:"No hay tickets recientes"})})]})]}),e.jsx(v,{isOpen:S,onClose:()=>y(!1),tickets:h,title:"Tickets Activos"}),e.jsx(v,{isOpen:M,onClose:()=>w(!1),tickets:h,title:"Tickets Pendientes"}),e.jsx(v,{isOpen:E,onClose:()=>T(!1),tickets:h,title:"Tickets Resueltos"})]})})}export{pe as default};
